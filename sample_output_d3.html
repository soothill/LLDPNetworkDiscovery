<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Topology - Interactive D3 Graph</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        h1 {
            text-align: center;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }
        #mynetwork {
            width: 100%;
            height: 700px;
            border: 2px solid rgba(255,255,255,0.3);
            background: linear-gradient(to bottom, #1a1a2e, #16213e);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            border-radius: 10px;
            cursor: grab;
            margin-bottom: 20px;
        }
        #mynetwork:active {
            cursor: grabbing;
        }
        .legend {
            margin: 20px auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            max-width: 900px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        .legend h3 {
            margin-top: 0;
            color: #333;
        }
        .legend-item {
            display: inline-block;
            margin-right: 25px;
            margin-bottom: 10px;
        }
        .legend-line {
            display: inline-block;
            width: 50px;
            height: 4px;
            vertical-align: middle;
            margin-right: 8px;
            border-radius: 2px;
        }
        .device-info {
            margin: 20px auto 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            max-width: 900px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        .device-info h3 {
            margin-top: 0;
            color: #333;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        .stat-box {
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .stat-label {
            font-size: 12px;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            margin-top: 5px;
        }
        .link {
            stroke-opacity: 0.7;
            stroke-width: 2px;
        }
        .link:hover {
            stroke-opacity: 1;
            stroke-width: 4px;
        }
        .node {
            cursor: grab;
            filter: drop-shadow(3px 3px 5px rgba(0,0,0,0.5));
        }
        .node:active {
            cursor: grabbing;
        }
        .node:hover {
            filter: drop-shadow(4px 4px 8px rgba(0,0,0,0.8));
        }
        .node text {
            font-size: 11px;
            font-weight: 600;
            pointer-events: none;
            text-anchor: middle;
            fill: white;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.9);
        }
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px 15px;
            border-radius: 6px;
            pointer-events: none;
            font-size: 13px;
            display: none;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.2);
        }
        .controls {
            text-align: center;
            margin: 20px auto;
            max-width: 900px;
        }
        .btn {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(255,255,255,0.3);
            padding: 10px 20px;
            margin: 5px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #667eea;
        }
        .btn:hover {
            background: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <h1>üåê Network Topology - Interactive Graph</h1>

    <div class="device-info">
        <h3>Network Statistics</h3>
        <div class="stats">
            <div class="stat-box">
                <div class="stat-label">Total Devices</div>
                <div class="stat-value" id="deviceCount">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Total Connections</div>
                <div class="stat-value" id="connectionCount">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Network Devices</div>
                <div class="stat-value" id="switchCount">0</div>
            </div>
        </div>
    </div>

    <div class="controls">
        <button class="btn" onclick="resetSimulation()">üîÑ Reset Layout</button>
        <button class="btn" onclick="zoomIn()">üîç+ Zoom In</button>
        <button class="btn" onclick="zoomOut()">üîç- Zoom Out</button>
        <button class="btn" onclick="resetZoom()">‚ÜîÔ∏è Reset Zoom</button>
    </div>

    <div id="mynetwork"></div>
    <div class="tooltip" id="tooltip"></div>

    <div class="legend">
        <h3>Legend</h3>
        <div style="margin-bottom: 15px;">
            <strong>Connection Speeds:</strong><br>
            <div class="legend-item">
                <span class="legend-line" style="background-color: #e74c3c;"></span>
                <span>Unknown Speed</span>
            </div>
            <div class="legend-item">
                <span class="legend-line" style="background-color: #3498db;"></span>
                <span>1 Gbps</span>
            </div>
            <div class="legend-item">
                <span class="legend-line" style="background-color: #2ecc71;"></span>
                <span>10 Gbps</span>
            </div>
            <div class="legend-item">
                <span class="legend-line" style="background-color: #9b59b6;"></span>
                <span>Other Speeds</span>
            </div>
        </div>
        <p style="margin-top: 15px; color: #666; font-size: 14px;">
            <strong>Device Types:</strong>
            <span style="color: #3498db;">‚óè</span> Switches/Arista/Aruba |
            <span style="color: #27ae60;">‚óè</span> MikroTik |
            <span style="color: #e67e22;">‚óè</span> Proxmox/Linux |
            <span style="color: #95a5a6;">‚óè</span> Others
        </p>
        <p style="color: #666; font-size: 14px; margin-top: 10px;">
            üí° <strong>Tip:</strong> Drag nodes to reposition ‚Ä¢ Scroll to zoom ‚Ä¢ Hover for details ‚Ä¢ Nodes have rubber-band physics!
        </p>
    </div>

    <script>
        // Sample network topology data
        const topologyData = {
            "devices": ["2930F-48", "MikroTik CRS326", "MikroTik RB5009", "MikroTik 4011", "MikroTik Hex", "arista", "proxmox", "linux-nas", "ruijie"],
            "connections": [
                {"local_device": "2930F-48", "local_port": "9", "remote_device": "MikroTik RB5009", "remote_port": "ether8", "local_speed": "1G", "remote_speed": "1G"},
                {"local_device": "2930F-48", "local_port": "31", "remote_device": "MikroTik CRS326", "remote_port": "ether1", "local_speed": "1G", "remote_speed": "1G"},
                {"local_device": "2930F-48", "local_port": "37", "remote_device": "MikroTik Hex", "remote_port": "ether2", "local_speed": "1G", "remote_speed": "1G"},
                {"local_device": "2930F-48", "local_port": "49", "remote_device": "MikroTik CRS326", "remote_port": "sfp-sfpplus16", "local_speed": "10G", "remote_speed": "10G"},
                {"local_device": "2930F-48", "local_port": "50", "remote_device": "MikroTik CRS326", "remote_port": "sfp-sfpplus15", "local_speed": "10G", "remote_speed": "10G"},
                {"local_device": "2930F-48", "local_port": "51", "remote_device": "MikroTik CRS326", "remote_port": "sfp-sfpplus13", "local_speed": "10G", "remote_speed": "10G"},
                {"local_device": "2930F-48", "local_port": "52", "remote_device": "MikroTik CRS326", "remote_port": "sfp-sfpplus14", "local_speed": "10G", "remote_speed": "10G"},
                {"local_device": "MikroTik RB5009", "local_port": "sfp-sfpplus1", "remote_device": "MikroTik CRS326", "remote_port": "sfp-sfpplus21", "local_speed": "10G", "remote_speed": "10G"},
                {"local_device": "MikroTik CRS326", "local_port": "sfp-sfpplus23", "remote_device": "MikroTik 4011", "remote_port": "sfp-sfpplus1", "local_speed": "10G", "remote_speed": "10G"},
                {"local_device": "MikroTik CRS326", "local_port": "sfp-sfpplus24", "remote_device": "arista", "remote_port": "Ethernet1", "local_speed": "10G", "remote_speed": "10G"},
                {"local_device": "MikroTik CRS326", "local_port": "qsfpplus1-1", "remote_device": "arista", "remote_port": "Ethernet2", "local_speed": "10G", "remote_speed": "10G"},
                {"local_device": "arista", "local_port": "Management1", "remote_device": "2930F-48", "remote_port": "20", "local_speed": "1G", "remote_speed": "1G"},
                {"local_device": "proxmox", "local_port": "eno1", "remote_device": "MikroTik CRS326", "remote_port": "ether5", "local_speed": "1G", "remote_speed": "1G"},
                {"local_device": "linux-nas", "local_port": "eth0", "remote_device": "2930F-48", "remote_port": "15", "local_speed": "1G", "remote_speed": "1G"},
                {"local_device": "ruijie", "local_port": "GigabitEthernet 0/1", "remote_device": "MikroTik Hex", "remote_port": "ether5", "local_speed": "1G", "remote_speed": "1G"}
            ]
        };

        // Helper functions
        function getDeviceColor(deviceName) {
            const name = deviceName.toLowerCase();
            if (name.includes('mikrotik')) return '#27ae60';
            if (name.includes('2930') || name.includes('2520') || name.includes('arista') ||
                name.includes('aruba') || name.includes('switch') || name.includes('crs')) return '#3498db';
            if (name.includes('proxmox') || name.includes('linux') || name.includes('nas')) return '#e67e22';
            if (name.includes('ruijie')) return '#9b59b6';
            return '#95a5a6';
        }

        function getNodeSize(deviceName) {
            const name = deviceName.toLowerCase();
            if (name.includes('crs326') || name.includes('2930f-48') || name.includes('arista')) return 30;
            if (name.includes('mikrotik') || name.includes('2520') || name.includes('aruba')) return 25;
            return 20;
        }

        function getEdgeColor(speed) {
            if (!speed || speed === 'Unknown') return '#e74c3c';
            if (speed.includes('1G') || speed.includes('1000')) return '#3498db';
            if (speed.includes('10G') || speed.includes('10000')) return '#2ecc71';
            return '#9b59b6';
        }

        // Collect all unique devices
        const allDevices = new Set(topologyData.devices);
        topologyData.connections.forEach(conn => {
            allDevices.add(conn.local_device);
            allDevices.add(conn.remote_device);
        });

        // Create nodes
        const nodes = Array.from(allDevices).map(device => ({
            id: device,
            label: device,
            color: getDeviceColor(device),
            size: getNodeSize(device)
        }));

        // Create edges (deduplicate bidirectional connections)
        const edgeMap = new Map();
        topologyData.connections.forEach(conn => {
            const key1 = `${conn.local_device}-${conn.remote_device}`;
            const key2 = `${conn.remote_device}-${conn.local_device}`;

            if (!edgeMap.has(key1) && !edgeMap.has(key2)) {
                edgeMap.set(key1, {
                    source: conn.local_device,
                    target: conn.remote_device,
                    color: getEdgeColor(conn.local_speed),
                    localPort: conn.local_port || '?',
                    remotePort: conn.remote_port || '?',
                    speed: conn.local_speed || 'Unknown'
                });
            }
        });

        const links = Array.from(edgeMap.values());

        // Update statistics
        document.getElementById('deviceCount').textContent = nodes.length;
        document.getElementById('connectionCount').textContent = links.length;
        document.getElementById('switchCount').textContent =
            nodes.filter(n => {
                const name = n.label.toLowerCase();
                return name.includes('2930') || name.includes('2520') ||
                       name.includes('crs') || name.includes('arista') ||
                       name.includes('aruba') || name.includes('switch');
            }).length;

        // D3.js force-directed graph
        const width = document.getElementById('mynetwork').clientWidth;
        const height = 700;

        const svg = d3.select('#mynetwork')
            .append('svg')
            .attr('width', width)
            .attr('height', height);

        // Add zoom behavior
        const g = svg.append('g');
        const zoom = d3.zoom()
            .scaleExtent([0.1, 4])
            .on('zoom', (event) => {
                g.attr('transform', event.transform);
            });
        svg.call(zoom);

        // Store zoom transform for reset
        let currentTransform = d3.zoomIdentity;

        // Create force simulation with physics
        const simulation = d3.forceSimulation(nodes)
            .force('link', d3.forceLink(links).id(d => d.id).distance(150).strength(0.5))
            .force('charge', d3.forceManyBody().strength(-600))
            .force('center', d3.forceCenter(width / 2, height / 2))
            .force('collision', d3.forceCollide().radius(60));

        // Create links
        const link = g.append('g')
            .selectAll('line')
            .data(links)
            .join('line')
            .attr('class', 'link')
            .attr('stroke', d => d.color)
            .on('mouseover', function(event, d) {
                d3.select('#tooltip')
                    .style('display', 'block')
                    .style('left', (event.pageX + 10) + 'px')
                    .style('top', (event.pageY - 10) + 'px')
                    .html(`<strong>Connection</strong><br>
                           ${d.source.id}:<strong>${d.localPort}</strong> ‚Üî
                           ${d.target.id}:<strong>${d.remotePort}</strong><br>
                           Speed: <strong>${d.speed}</strong>`);
            })
            .on('mouseout', function() {
                d3.select('#tooltip').style('display', 'none');
            });

        // Create nodes
        const node = g.append('g')
            .selectAll('g')
            .data(nodes)
            .join('g')
            .attr('class', 'node')
            .call(d3.drag()
                .on('start', dragstarted)
                .on('drag', dragged)
                .on('end', dragended));

        node.append('rect')
            .attr('width', d => d.size * 2.8)
            .attr('height', d => d.size * 1.6)
            .attr('x', d => -d.size * 1.4)
            .attr('y', d => -d.size * 0.8)
            .attr('rx', 6)
            .attr('fill', d => d.color)
            .attr('stroke', '#fff')
            .attr('stroke-width', 2.5);

        node.append('text')
            .text(d => d.label)
            .attr('dy', 4)
            .on('mouseover', function(event, d) {
                const connections = links.filter(l =>
                    l.source.id === d.id || l.target.id === d.id
                );
                d3.select('#tooltip')
                    .style('display', 'block')
                    .style('left', (event.pageX + 10) + 'px')
                    .style('top', (event.pageY - 10) + 'px')
                    .html(`<strong>${d.label}</strong><br>
                           Type: ${getDeviceType(d.label)}<br>
                           Connections: <strong>${connections.length}</strong>`);
            })
            .on('mouseout', function() {
                d3.select('#tooltip').style('display', 'none');
            });

        function getDeviceType(name) {
            const n = name.toLowerCase();
            if (n.includes('mikrotik')) return 'MikroTik Device';
            if (n.includes('arista')) return 'Arista Switch';
            if (n.includes('aruba') || n.includes('2930') || n.includes('2520')) return 'HP Aruba Switch';
            if (n.includes('proxmox')) return 'Proxmox Host';
            if (n.includes('linux') || n.includes('nas')) return 'Linux Server';
            if (n.includes('ruijie')) return 'Ruijie Switch';
            return 'Network Device';
        }

        // Update positions on each tick
        simulation.on('tick', () => {
            link
                .attr('x1', d => d.source.x)
                .attr('y1', d => d.source.y)
                .attr('x2', d => d.target.x)
                .attr('y2', d => d.target.y);

            node
                .attr('transform', d => `translate(${d.x},${d.y})`);
        });

        // Drag functions with rubber-band physics
        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            // Release fixed position for rubber-band effect
            d.fx = null;
            d.fy = null;
        }

        // Control functions
        function resetSimulation() {
            nodes.forEach(d => {
                d.fx = null;
                d.fy = null;
            });
            simulation.alpha(1).restart();
        }

        function zoomIn() {
            svg.transition().call(zoom.scaleBy, 1.3);
        }

        function zoomOut() {
            svg.transition().call(zoom.scaleBy, 0.7);
        }

        function resetZoom() {
            svg.transition().call(zoom.transform, d3.zoomIdentity);
        }
    </script>
</body>
</html>
